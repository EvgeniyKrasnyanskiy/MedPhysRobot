# utils/editor.py

import asyncio
import re
import os
from aiogram import Bot
from aiogram.client.default import DefaultBotProperties
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ .env
load_dotenv()
BOT_TOKEN = os.getenv("BOT_TOKEN")

bot = Bot(token=BOT_TOKEN, default=DefaultBotProperties(parse_mode="HTML"))

def parse_group_link(link: str) -> tuple[int, int]:
    m = re.search(r"t\.me/c/(\d+)/(\d+)", link)
    if not m:
        raise ValueError("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏")
    chat_id = int("-100" + m.group(1))   # –ø—Ä–∞–≤–∏–ª—å–Ω–æ!
    msg_id = int(m.group(2))
    return chat_id, msg_id

async def edit_group_message(group_link: str, new_text: str) -> bool:
    try:
        group_chat, group_msg_id = parse_group_link(group_link)

        await bot.edit_message_text(
            chat_id=group_chat,
            message_id=group_msg_id,
            text=new_text
        )
        print(f"–°–æ–æ–±—â–µ–Ω–∏–µ {group_msg_id} –≤ —á–∞—Ç–µ {group_chat} –æ–±–Ω–æ–≤–ª–µ–Ω–æ")
        return True
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        return False
    finally:
        await bot.session.close()

async def main():
    group_link = "https://t.me/c/1102663807/40322"

    new_text = """‚ÄºÔ∏è–í–µ–±–∏–Ω–∞—Ä 6 –Ω–æ—è–±—Ä—è 2025 (—á–µ—Ç–≤–µ—Ä–≥)
üìå12:30 ‚Äì 13:30 CET (–º–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è MSK 14:30 ‚Äì 15:30)

C–∫—Ä–∏–ø—Ç –∫–∞–∫ —Å—Ü–µ–Ω–∞—Ä–∏–π —É—Å–ø–µ—Ö–∞ ‚Äì –ø–æ–≤—ã—à–µ–Ω–∏–µ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å ESAPI

üîó <a href="https://web.cvent.com/event/67e194e2-25a1-4100-991c-819a4261bd53/regProcessStep1?mkt_tok=...">–°—Å—ã–ª–∫–∞</a> –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

üí¨–í–µ–±–∏–Ω–∞—Ä –ø–æ—Å–≤—è—â–µ–Ω –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤ –ª—É—á–µ–≤–æ–π —Ç–µ—Ä–∞–ø–∏–∏

‚ÑπÔ∏è–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ 60-–º–∏–Ω—É—Ç–Ω–æ–π —Å–µ—Å—Å–∏–∏ –∏ —É–∑–Ω–∞—Ç—å, –∫–∞–∫ —Å–∫—Ä–∏–ø—Ç–∏–Ω–≥ –≤ ESAPI –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ä–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ –ª—É—á–µ–≤–æ–π —Ç–µ—Ä–∞–ø–∏–∏.
–ù–∞ –≤–µ–±–∏–Ω–∞—Ä–µ –≤—ã—Å—Ç—É–ø—è—Ç –≠—Ä–∏–∫ –§—É—Ä–∞ –∏–∑ V√§stmanlands sjukhus V√§ster√•s –∏ –®—Ä–∏—Ä–∞–º –ü–∞–¥–º–∞–Ω–∞–±–∞–Ω –∏–∑ Oxford University Hospital NHS Trust. –û–Ω–∏ –ø–æ–¥–µ–ª—è—Ç—Å—è —Å–≤–æ–∏–º —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–º –º–Ω–µ–Ω–∏–µ–º –æ —Ç–æ–º, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏, –ø–æ–≤—ã—à–µ–Ω–∏—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—é –∫–∞—á–µ—Å—Ç–≤–∞ –ª–µ—á–µ–Ω–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤.

‚úîÔ∏è–¢–µ–º—ã –≤–µ–±–∏–Ω–∞—Ä–∞:
‚Ä¢ –†–∞–∑–≤–∏—Ç–∏–µ –Ω–∞–≤—ã–∫–æ–≤ —Ä–∞–±–æ—Ç—ã –≤ ESAPI: —É–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –æ–≤–ª–∞–¥–µ–≤–∞—é—Ç –Ω–∞–≤—ã–∫–∞–º–∏ —Ä–∞–±–æ—Ç—ã —Å–æ —Å–∫—Ä–∏–ø—Ç–∞–º–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ª—É—á–µ–≤–æ–π —Ç–µ—Ä–∞–ø–∏–∏.
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –≤ –¥–µ–π—Å—Ç–≤–∏–∏: —É–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ—Ä–∞–ø–∏–∏ —Å–æ–∫—Ä–∞—â–∞—é—Ç –æ–±—ä–µ–º —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã, —Å–≤–æ–¥—è—Ç –∫ –º–∏–Ω–∏–º—É–º—É —Ä–∏—Å–∫ –æ—à–∏–±–∫–∏ –∏–∑-–∑–∞ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ —Ñ–∞–∫—Ç–æ—Ä–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç —Ä–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã.
‚Ä¢ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è, —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –ø–æ–≤—ã—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–∞–∫—Ç–∏–∫–µ –ª—É—á–µ–≤–æ–π —Ç–µ—Ä–∞–ø–∏–∏.

üìé–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —Å–±–æ—Ä –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫–∏—Ö –∫–∞–∫ –∏–º—è, –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã, –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –º–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ä–æ–ª—å –∏ —Ç. –¥.

#–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ

–ò—Å—Ç–æ—á–Ω–∏–∫: @MedPhysProChannel"""

    await edit_group_message(group_link, new_text)

if __name__ == "__main__":
    asyncio.run(main())